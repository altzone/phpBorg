# phpBorg Agent Worker - Agent deployment operations
# Allows phpborg user to manage agent SSH keys and backup directories
# This file is auto-updated by phpBorg during updates

# Gestion des repertoires de backup pour les agents
phpborg ALL=(root) NOPASSWD: /bin/mkdir -p /opt/backups/*
phpborg ALL=(root) NOPASSWD: /bin/chown phpborg-borg\:phpborg-borg /opt/backups/*
phpborg ALL=(root) NOPASSWD: /bin/chmod 750 /opt/backups/*

# Gestion du repertoire SSH de phpborg-borg
phpborg ALL=(root) NOPASSWD: /bin/mkdir -p /var/lib/phpborg-borg/.ssh
phpborg ALL=(root) NOPASSWD: /bin/chown phpborg-borg\:phpborg-borg /var/lib/phpborg-borg/.ssh
phpborg ALL=(root) NOPASSWD: /bin/chmod 700 /var/lib/phpborg-borg/.ssh

# Gestion du fichier authorized_keys
phpborg ALL=(root) NOPASSWD: /bin/touch /var/lib/phpborg-borg/.ssh/authorized_keys
phpborg ALL=(root) NOPASSWD: /bin/cat /var/lib/phpborg-borg/.ssh/authorized_keys
phpborg ALL=(root) NOPASSWD: /bin/cp /tmp/phpborg_authorized_keys_* /var/lib/phpborg-borg/.ssh/authorized_keys
phpborg ALL=(root) NOPASSWD: /bin/chown phpborg-borg\:phpborg-borg /var/lib/phpborg-borg/.ssh/authorized_keys
phpborg ALL=(root) NOPASSWD: /bin/chmod 600 /var/lib/phpborg-borg/.ssh/authorized_keys

# Lecture des repertoires (pour verification)
phpborg ALL=(root) NOPASSWD: /bin/ls /var/lib/phpborg-borg
phpborg ALL=(root) NOPASSWD: /bin/ls /var/lib/phpborg-borg/.ssh
phpborg ALL=(root) NOPASSWD: /bin/ls /opt/backups
phpborg ALL=(root) NOPASSWD: /bin/ls /opt/backups/*
